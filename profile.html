<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <title>Profile</title>
</head>
<body>
    <header>
        <h1>SSU New Gen TechMart</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="shop.html">Shop</a>
            <a href="cart.html" class="header-cart cart-btn" aria-label="View cart">
                <svg class="cart-icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 6h15l-1.5 9h-11L6 6z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="10" cy="20" r="1" fill="currentColor" />
                    <circle cx="18" cy="20" r="1" fill="currentColor" />
                </svg>
                <span class="cart-count">0</span>
            </a>
            <a href="login.html" class="login-btn">Login</a>
        </nav>
    </header>

    <main class="container" style="padding:40px;">
        <div class="glass-container" style="max-width:720px;margin:0 auto;">
            <h2>Your Profile</h2>
            <p id="profileName">Loading...</p>
            <p id="profileEmail"></p>
            <div style="margin-top:18px;">
                <button id="logoutBtn" class="btn secondary">Logout</button>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function(){
            const user = (function(){ try { return JSON.parse(localStorage.getItem('user')); } catch(e){ return null; } })();
            const nameEl = document.getElementById('profileName');
            const emailEl = document.getElementById('profileEmail');
            
            if (user) {
                nameEl.textContent = 'Name: ' + (user.name || 'Account');
                if (user.email) emailEl.textContent = 'Email: ' + user.email;
            } else {
                nameEl.textContent = 'Not signed in';
                emailEl.textContent = '';
                // Try to fetch from session
                try {
                    const response = await fetch('api_check_session.php');
                    const data = await response.json();
                    if (data.logged_in && data.user) {
                        localStorage.setItem('user', JSON.stringify(data.user));
                        nameEl.textContent = 'Name: ' + (data.user.name || 'Account');
                        if (data.user.email) emailEl.textContent = 'Email: ' + data.user.email;
                    }
                } catch (err) {
                    console.error('Error checking session:', err);
                }
            }
            
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) logoutBtn.addEventListener('click', function(){
                logoutUser();
                setTimeout(()=> location.href = 'index.html', 150);
            });
        });
    </script>
</body>
</html>
